{% extends 'admin/base.html.twig' %}

{% block title %}Nouveau restaurant - Être Végétarien !{% endblock %}
{% block stylesheets %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Trumbowyg/2.19.1/ui/trumbowyg.min.css">
{% endblock %}
{% block body %}
<section class="container">
    <a href="{{ path('adminGestionRestaurants') }}" class="btn btn-primary btnRetour mt-4"><i class="far fa-backspace"
            aria-hidden="true"></i> Retour</a>
</section>
<section id="panel" class="container">
    <div class="editRestaurant">
        <div class="flex">
            <input id="nom" value="" class="margin-auto" />
        </div>
        <div class="btnForSaveAndCancel">
            <div class="input-group mb-3 mt-3">
                <div class="input-group-prepend hidden">
                    <span class="input-group-text">URL de l'image : </span>
                </div>
                <input type="text" class="form-control hidden" id="image" value="">
                <div class="input-group-prepend">
                    <span class="input-group-text">Ville : </span>
                </div>
                <input type="text" class="form-control" id="ville" value="">
                <div class="input-group-prepend">
                    <span class="input-group-text">Adresse : </span>
                </div>
                <input type="text" class="form-control" id="adresse" value="">
            </div>
            <textarea id="editeur"></textarea>
            <div class="input-group mb-3">
                <form method="post" class="w-100" action="" enctype="multipart/form-data" id="uploadImage">
                    <div class="input-group mb-3 w-100">
                        <div class="custom-file w-100">
                            <input type="file" class="custom-file-input" id="file">
                            <label class="custom-file-label" for="file">Choisir l'image de présentation</label>
                        </div>
                    </div>
                    <button id="btnUploadImage" type="button" class="btn btn-primary w-100">Envoyer l'image</button>
                </form>
            </div>
            <button id="btnSaveRestaurant" type="button" class="btn btn-primary">Sauvegarder</button>
            <button type="button" class="btn btn-secondary btnCancelRestaurant">Annuler</button>
        </div>
    </div>
    <div id="resultat"></div>
</section>
{% endblock %}

{% block javascript %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Trumbowyg/2.19.1/trumbowyg.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Trumbowyg/2.19.1/langs/fr.min.js"></script>
<script>
    $('#editeur').trumbowyg({
        lang: 'fr'
    });
    $(document).ready(function () {
        $("#btnSaveRestaurant").click(function (e) {
            e.preventDefault();
            $.post(
                "{{ path('admin_save_restaurant') }}",
                {
                    nom: $("#nom").val(),
                    adresse: $("#adresse").val(),
                    ville: $("#ville").val(),
                    restaurant_id: 'new',
                    image: $("#image").val(),
                    contenu: $("#editeur").val()
                },
                function (data) {
                    if (data.code == 200) {
                        $("#resultat").html("<p>" + data.message + "</p>");
                    }
                    else {
                        $("#resultat").html("<p>" + data.message + "</p>");
                    }
                },
                'json'
            );
        });
        $("#btnUploadImage").click(function () {
            var fd = new FormData();
            var files = $('#file')[0].files[0];
            fd.append('file', files);
            $.ajax({
                url: "{{ path('admin_upload_image') }}",
                type: 'post',
                data: fd,
                contentType: false,
                processData: false,
                success: function (response) {
                    $("#image").attr("value", response.location)
                    $("#resultat").html("<p>" + response.message + "</p>");
                },
            });
        });
    });
</script>
{% endblock %}