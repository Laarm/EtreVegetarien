{% extends 'base.html.twig' %}

{% block title %}
{{ repas.nom }} - Être Végétarien!
{% endblock %}
{% block stylesheets %}
<script src="{{ asset('/js/pagination.js') }}"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
    integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
    crossorigin="" />
<link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/MarkerCluster.Default.css">
{% endblock %}
{% block body %}

<style>
    #repas h1 {
        color: #4e4e56;
        font-size: 2em;
        font-weight: bold;
    }

    #repas p {
        color: #939396;
    }

    #repas a {
        color: #939396
    }

    #repas .avis .right {
        height: 24px;
        margin-left: auto;
        margin-top: -9px;
        zoom: .8
    }

    #repas h2 {
        color: #939396;
        font-size: 1.2em;
        margin-top: 20px
    }

    #repas .left .flex.flex-between {
        align-items: center;
    }

    #repas h1.titre {
        font-size: 1.4em
    }

    #repas .left .note span {
        font-size: 2em;
        font-weight: bold;
    }

    #repas .left .note span {
        font-size: 2em;
        font-weight: bold;
        color: #4e4e56;
    }

    #repas .left .avis {
        margin-top: -8px
    }

    .tab-pane.fade {
        padding-top: 40px
    }

    .nav.nav-tabs {
        padding-top: 40px
    }

    .nav.nav-tabs {
        border: none
    }

    .nav.nav-tabs li.nav-item a {
        border: none;
        color: #4e4e56;
    }

    .nav.nav-tabs li.nav-item a.active {
        border: none;
        border-bottom: #58D68D 6px solid
    }

    #repas .avis span.date {
        color: #58D68D;
        margin-top: -13px;
        display: block;
    }

    #repas .avis .message {
        padding: 7.5px 0 7.5px 15px;
        border-left: #939396 1px solid;
        margin-top: 13px
    }

    #repas .avis .username {
        font-weight: bold;
    }

    #repas #avis .avis {
        margin-bottom: 40px;
        padding-bottom: 20px;
        border-bottom: 1px solid rgba(0, 0, 0, .1);
    }

    #map {
        height: 300px;
        width: 100%;
    }

    .container .right .content .repas a {
        text-decoration: none
    }

    .container .right .content .repas {
        /* border-bottom: 1px solid #ECEEF2; */
        width: 100%;
        padding-bottom: 10px;
        margin-top: 20px
    }

    .container .right .content .repas h1 {
        margin-top: 2.5%;
        font-size: 1rem !important;
        font-weight: bold !important;
        color: #58D68D !important
    }

    .container .right .content .repas h2 {
        margin-top: 2.5%;
        font-size: 0.8rem !important;
        font-weight: bold !important
    }

    .container .right .content .note span {
        font-size: 1.9rem !important;
        font-weight: bold !important
    }

    .page-item.active a {
        background-color: #58D68D !important;
        border-color: #61ed9c !important;
    }

    .ratings {
        list-style-type: none;
        margin: 0;
        padding: 0;
        width: 100%;
        direction: rtl;
        text-align: left;
    }

    .star {
        position: relative;
        line-height: 60px;
        display: inline-block;
        transition: color 0.2s ease;
        color: #ebebeb;
    }

    .star:hover,
    .star.selected,
    .star:hover~.star,
    .star.selected~.star {
        transition: color 0.8s ease;
        color: #58D68D;
    }

    #repas a.btn-primary {
        color: #FFF
    }

    #repas .media {
        text-decoration: none;
    }

    @media(max-width: 991px) {}
</style>
<section id="repas" class="container paddingSeperateur flex">
    <div class="left col-7">
        <div class="flex flex-between">
            <h1 class="mtb-auto">{{ repas.nom }}</h1>
            <p class="note mtb-auto">
                <i class="fad fa-star"></i>
        </div>
        <div class="flex flex-between">
            <h2 class="mtb-auto">Publié le <strong>{{repas.createdAt|date("d/m/Y")}}</strong>
            </h2>
        </div>
        <div class="w-100">
            <ul class="nav nav-tabs" id="tab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="infospratiques-tab" data-toggle="tab" href="#infospratiques"
                        role="tab" aria-controls="infospratiques" aria-selected="true">INFOS PRATIQUES</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="avis-tab" data-toggle="tab" href="#avis" role="tab" aria-controls="avis"
                        aria-selected="false">FAVORIS</a>
                </li>
            </ul>
            <div class="tab-content" id="tabContent">
                <div class="tab-pane fade show active" id="infospratiques" role="tabpanel"
                    aria-labelledby="infospratiques-tab">
                    {{ repas.recette | raw }}
                </div>
                <div class="tab-pane fade" id="avis" role="tabpanel" aria-labelledby="avis-tab">
                    <div paginationView="avis" class="avisCont">
                        <div class="avisContent contentPagination">
                            {% for favoris in repasFavoris %}
                            <a class="media" href="{{ path('user', {'id': favoris.Repas.PostedBy.id}) }}">
                                <img id="avatar" class="mr-3 rond" src="{{ asset(favoris.Repas.PostedBy.avatar) }}"
                                    alt="Votre avatar" style="height: 40px;width: 40px">
                                <div class="media-body">
                                    <p>{{ favoris.Repas.PostedBy.username }}</p>
                                    <p class="mt--20 cds"><strong
                                            class="cds">{{ favoris.Repas.PostedBy.preference }}</strong>
                                    </p>
                                </div>
                            </a>
                            {% else %}
                            <p class="text-center">Aucune personne à ajouter ce repas en favoris</p>
                            {% endfor %}
                        </div>
                    </div>
                    <div paginationBtn="avis" class="pagination justify-content-end">
                        <div class="btnPagination flex mr-4">
                        </div>
                    </div>
                    <div id="resultat"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="right col-5">
        <h1>
            <h1 class="titre">
                <span>Publié par</span>
            </h1>
        </h1>
        <div class="content">
            <a class="media" href="{{ path('user', {'id': repas.PostedBy.id}) }}">
                <img id="avatar" class="mr-3 rond" src="{{ asset(repas.PostedBy.avatar) }}" alt="Votre avatar"
                    style="height: 40px;width: 40px">
                <div class="media-body">
                    <p>Arnaud</p>
                    <p class="mt--20 cds"><strong class="cds">{{ repas.PostedBy.preference }}</strong></p>
                </div>
            </a>
        </div>
        <h1>
            <h1 class="titre">
                <span>Autres repas</span>
            </h1>
        </h1>
        <div class="content">
            {% for repas in autresrepas %}
            {% if loop.index != 1 %}
            <hr>
            {% endif %}
            <div class="repas flex flex-between">
                <div class="left">
                    <a href="{{ path('repas_show', {'id': repas.id}) }}">
                        <h1 class="cds">{{ repas.nom }}</h1>
                        <h2 class="gris">{{ repas.PostedBy.username }}, Végétarien</h2>
                    </a>
                </div>
                <div class="right mtb-auto flex">
                    <p class="mtb-auto note">
                        <i class="fad fa-star"></i>
                </div>
            </div>
            {% else %}
            <em>Aucun repas</em>
            {% endfor %}
        </div>
    </div>
</section>
{% endblock %}
{% block javascript %}
<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
    integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
    crossorigin=""></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/leaflet.markercluster.js"></script>
<script>
    addEventListener("load", () => {
        new pagination("avis", 3, 10, "block");
    })
    $("#btnEnvoieNote").click(function (e) {
        e.preventDefault();
        $.post('/ajax/repas/sendNote', {
            note: $(".star.selected~.star").length + 1,
            message: $("#message").val(),
            repas_id: '{{ repas.id }}',
            csrfData: "{{ csrf_token('send-note') }}"
        }, function (data) {
            if (data.code == '200') {
                $("#resultat").html("<div class='content'><p>" + data.message + "</p></div>");
                $("#avis .avisCont").load("{{ path('repas_show', {'id': repas.id}) }}?view=0&maxView=3 #avis .avisContent");
            } else {
                $("#resultat").html("<div class='content red'><p>" + data.message + "</p></div>");
            }
        }, 'json');
    });
</script>
{% endblock %}