{% extends 'base.html.twig' %}

{% block title %}{{ store.nom }} - Être Végétarien!{% endblock %}
{% block stylesheets %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
    integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
    crossorigin="" />
<link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/MarkerCluster.Default.css">
{% endblock %}
{% block body %}
<style>
    #store .nav-search i {
        position: absolute;
        padding: 10px;
        margin-top: 2px;
        color: #aaabae;
        z-index: 2;
    }

    .nav-search input {
        background-color: transparent !important;
        padding-left: 30px;
        border-radius: 200px !important;
        -moz-border-radius: 200px !important;
        -webkit-border-radius: 200px 200px 200px 200px !important;
    }

    #store .produit-list-design {
        margin-top: 5%
    }

    #store .produit-list-design .item {
        width: 30%;
        margin-bottom: 5%;
        -webkit-box-shadow: 0px 0px 48px -20px rgba(0, 0, 0, 0.75);
        -moz-box-shadow: 0px 0px 48px -20px rgba(0, 0, 0, 0.75);
        box-shadow: 0px 0px 48px -20px rgba(0, 0, 0, 0.75);
    }

    #store .produit-list-design .item .top {
        transition-duration: .3s;
        background-color: #279156;
        display: flex;
        padding: 30px
    }

    #store .produit-list-design .item .top img {
        width: 80%;
        margin: auto;
        transition-duration: .3s;
    }

    #store .produit-list-design .item .bottom {
        transition-duration: .3s;
        background-color: #FFF;
        text-align: center;
        color: #000;
        padding: 5px 10px;
        height: 60px;
        display: flex;
    }

    #store .produit-list-design .item .bottom p {
        margin: auto;
        font-weight: bolder;
    }

    #store .produit-list-design .item:hover .top {
        transition-duration: .3s;
        background-color: #FFF;
    }

    #store .produit-list-design .item:hover .top img {
        transition-duration: .3s;
        transform: scale(0.9);
    }

    #store .produit-list-design .item:hover .bottom {
        transition-duration: .3s;
        background-color: #279156;
        height: 160px;
        margin-top: -100px;
    }

    #store .produit-list-design .item:hover .bottom p {
        margin: auto auto 13px auto;
    }

    @media(max-width: 991px) {
        #store .produit-list-design .item {
            width: 90%;
            margin: auto;
            margin-bottom: 5%
        }
    }

    #store .banniere_store {
        height: 300px;
        width: 100%;
    }

    #store #map {
        height: 600px;
        width: 100%;
    }

    .tab-pane.fade {
        padding-top: 40px
    }

    .nav.nav-tabs {
        padding-top: 40px
    }

    .nav.nav-tabs {
        border: none
    }

    .nav.nav-tabs li.nav-item a {
        border: none;
        color: #4e4e56;
    }

    .nav.nav-tabs li.nav-item a.active {
        border: none;
        border-bottom: #58D68D 6px solid
    }
</style>
<section id="store" class="container paddingSeperateur">
    <h1>{{ store.nom }}</h1>
    <div class="banniere_store"
        style="background-image: url('{{ asset(store.image) }}');background-size: 100% auto;background-position: center">
    </div>
    <div class="w-100">
        <ul class="nav nav-tabs" id="tab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="infospratiques-tab" data-toggle="tab" href="#infospratiques" role="tab"
                    aria-controls="infospratiques" aria-selected="true">PLAN</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="avis-tab" data-toggle="tab" href="#avis" role="tab" aria-controls="avis"
                    aria-selected="false">PRODUIT(S)</a>
            </li>
        </ul>
        <div class="tab-content" id="tabContent">
            <div class="tab-pane fade show active" id="infospratiques" role="tabpanel"
                aria-labelledby="infospratiques-tab">
                <div id="map"></div>
            </div>
            <div class="tab-pane fade" id="avis" role="tabpanel" aria-labelledby="avis-tab">
                <div class="produit-list-design flex flex-wrap flex-between">
                    {% for produit in produits %}
                    <div class="item">
                        <a href="#">
                            <div class="top">
                                <img alt="{{ produit.Produit.nom }}" src="{{ asset(produit.Produit.image) }}" />
                            </div>
                            <div class="bottom">
                                <p>{{ produit.Produit.nom }}</p>
                            </div>
                        </a>
                        <div btnFavoris="{{produit.Produit.id}}"
                            class="{% for favoris in produit.Produit.produitFavoris %}{% if favoris.postedById.id == app.user.id %}active{% endif %}{% endfor %}">
                            <i class="cursor-pointer fad fa-star"></i>
                        </div>
                    </div>
                    {% else %}
                    <p class="text-center">Aucun produit</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}
{% block javascript %}
<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
    integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
    crossorigin=""></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/leaflet.markercluster.js"></script>
<script>
    $.getJSON("https://api-adresse.data.gouv.fr/search/?q= {{ store.adresse }}&limit=1").then((store) => {
        lat = store.features[0]['geometry']['coordinates'][1];
        lon = store.features[0]['geometry']['coordinates'][0];
        initMap();
    });
    var macarte = null;
    function initMap() {
        macarte = L.map('map').setView([
            lat, lon
        ], 16);
        macarte.panTo(L.latLng(lat, lon));
        L.tileLayer('https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', {
            attribution: 'données © <a href="//osm.org/copyright">OpenStreetMap</a>/ODbL - rendu <a href="//openstreetmap.fr">OSM France</a>',
            minZoom: 1,
            maxZoom: 20
        }).addTo(macarte);
        var marker = L.marker([lat, lon]).addTo(macarte);
    }
    $("[btnFavoris]").click(function (e) {
        e.preventDefault();
        $.post("{{ path('produit_favoris') }}", {
            produit_id: $(this).attr('btnFavoris'),
            csrfData: "{{ csrf_token('produit-favoris') }}"
        }, function (data) {
            if (data.code == '200') {
                $('[btnFavoris = "' + data.id + '"]').addClass('active')
            }
            if (data.code == '201') {
                $('[btnFavoris = "' + data.id + '"]').removeClass('active')
            }
        }, 'json');
    });
</script>
{% endblock %}