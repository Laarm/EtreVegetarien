{% extends 'base.html.twig' %}

{% block title %}
	{{ meal.nom }}
	- Être Végétarien!
{% endblock %}
{% block stylesheets %}
	<script src="{{ asset('/js/pagination.js') }}"></script>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/MarkerCluster.Default.css">
{% endblock %}
{% block body %}

	<style>
		#meal h1 {
			color: #4e4e56;
			font-size: 2em;
			font-weight: bold;
		}

		#meal p {
			color: #939396;
		}

		#meal a {
			color: #939396
		}

		#meal .feedback .right {
			height: 24px;
			margin-left: auto;
			margin-top: -9px;
			zoom: .8
		}

		#meal h2 {
			color: #939396;
			font-size: 1.2em;
			margin-top: 20px
		}

		#meal .left .flex.flex-between {
			align-items: center;
		}

		#meal h1.titre {
			font-size: 1.4em
		}

		#meal .left .note span {
			font-size: 2em;
			font-weight: bold;
		}

		#meal .left .note span {
			font-size: 2em;
			font-weight: bold;
			color: #4e4e56;
		}

		#meal .left .feedback {
			margin-top: -8px
		}

		.tab-pane.fade {
			padding-top: 40px
		}

		.nav.nav-tabs {
			padding-top: 40px
		}

		.nav.nav-tabs {
			border: none
		}

		.nav.nav-tabs li.nav-item a {
			border: none;
			color: #4e4e56;
		}

		.nav.nav-tabs li.nav-item a.active {
			border: none;
			border-bottom: #58D68D 6px solid
		}

		#meal .feedback span.date {
			color: #58D68D;
			margin-top: -13px;
			display: block;
		}

		#meal .feedback .message {
			padding: 7.5px 0 7.5px 15px;
			border-left: #939396 1px solid;
			margin-top: 13px
		}

		#meal .feedback .username {
			font-weight: bold;
		}

		#meal #feedback .feedback {
			margin-bottom: 40px;
			padding-bottom: 20px;
			border-bottom: 1px solid rgba(0, 0, 0, 0.1);
		}

		#map {
			height: 300px;
			width: 100%;
		}

		.container .right .content .meal a {
			text-decoration: none
		}

		.container .right .content .meal {
			/* border-bottom: 1px solid #ECEEF2; */
			width: 100%;
			padding-bottom: 10px;
			margin-top: 20px
		}

		.container .right .content .meal h1 {
			margin-top: 2.5%;
			font-size: 1rem !important;
			font-weight: bold !important;
			color: #58D68D !important
		}

		.container .right .content .meal h2 {
			margin-top: 2.5%;
			font-size: 0.8rem !important;
			font-weight: bold !important
		}

		.container .right .content .note span {
			font-size: 1.9rem !important;
			font-weight: bold !important
		}

		.page-item.active a {
			background-color: #58D68D !important;
			border-color: #61ed9c !important;
		}

		.ratings {
			list-style-type: none;
			margin: 0;
			padding: 0;
			width: 100%;
			direction: rtl;
			text-align: left;
		}

		.star {
			position: relative;
			line-height: 60px;
			display: inline-block;
			transition: color 0.2s ease;
			color: #ebebeb;
		}

		.star:hover,
		.star.selected,
		.star:hover~.star,
		.star.selected~.star {
			transition: color 0.8s ease;
			color: #58D68D;
		}

		#meal a.btn-primary {
			color: #FFF
		}

		#meal .media {
			text-decoration: none;
		}

		[btnFavorites] {
			font-size: 25px;
			transition-duration: 1s;
		}

		[btnFavorites]:hover,
		[btnFavorites]:focus,
		[btnFavorites]:active,
		[btnFavorites].active {
			color: #58D68D;
		}

		[btnFavorites]:active {
			transition-duration: 0.1s;
			transform: scale(1.5);
		}

		[btnFavorites].f-20 {
			font-size: 20px
		}

		@media(max-width: 991px) {}
	</style>
	<section id="meal" class="container paddingSeperateur flex">
		<div class="left col-7">
			<div class="flex flex-between">
				<h1 class="mtb-auto">{{ meal.nom }}</h1>
				<p class="note mtb-auto">
					<i btnfavorites="{{meal.id}}" class="{% for favorites in meal.mealFavorites %}{% if favorites.postedBy.id == app.user.id %}active{% endif %}{% endfor %} cursor-pointer fad fa-star"></i>
				</p>
			</div>
			<div class="flex flex-between">
				<h2 class="mtb-auto">Publié le
					<strong>{{meal.createdAt|date("d/m/Y")}}</strong>
				</h2>
			</div>
			<div class="w-100">
				<ul class="nav nav-tabs" id="tab" role="tablist">
					<li class="nav-item">
						<a class="nav-link active" id="infospratiques-tab" data-toggle="tab" href="#infospratiques" role="tab" aria-controls="infospratiques" aria-selected="true">INFOS PRATIQUES</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" id="feedback-tab" data-toggle="tab" href="#feedback" role="tab" aria-controls="feedback" aria-selected="false">FAVORIS</a>
					</li>
				</ul>
				<div class="tab-content" id="tabContent">
					<div class="tab-pane fade show active" id="infospratiques" role="tabpanel" aria-labelledby="infospratiques-tab">
						{{ meal.recette | raw }}
					</div>
					<div class="tab-pane fade" id="feedback" role="tabpanel" aria-labelledby="feedback-tab">
						<div paginationview="feedback" class="feedbackCont">
							<div class="feedbackContent contentPagination">
								{% for favorites in mealFavorites %}
									<a class="media" href="{{ path('user', {'id': favorites.Meal.PostedBy.id}) }}">
										<img id="avatar" class="mr-3 rond" src="{{ asset(favorites.Meal.PostedBy.avatar) }}" alt="Votre avatar" style="height: 40px;width: 40px">
										<div class="media-body">
											<p>{{ favorites.Meal.PostedBy.username }}</p>
											<p class="mt--20 cds">
												<strong class="cds">{{ favorites.Meal.PostedBy.preference }}</strong>
											</p>
										</div>
									</a>
								{% else %}
									<p class="text-center">Aucune personne à ajouter ce meal en favorites</p>
								{% endfor %}
							</div>
						</div>
						<div paginationbtn="feedback" class="pagination justify-content-end">
							<div class="btnPagination flex mr-4"></div>
						</div>
						<div id="resultat"></div>
					</div>
				</div>
			</div>
		</div>
		<div class="right col-5">
			<h1>
				<h1 class="titre">
					<span>Publié par</span>
				</h1>
			</h1>
			<div class="content">
				<a class="media" href="{{ path('user', {'id': meal.PostedBy.id}) }}">
					<img id="avatar" class="mr-3 rond" src="{{ asset(meal.PostedBy.avatar) }}" alt="Votre avatar" style="height: 40px;width: 40px">
					<div class="media-body">
						<p>Arnaud</p>
						<p class="mt--20 cds">
							<strong class="cds">{{ meal.PostedBy.preference }}</strong>
						</p>
					</div>
				</a>
			</div>
			<h1>
				<h1 class="titre">
					<span>Autres meal</span>
				</h1>
			</h1>
			<div class="content">
				{% for meal in autresmeal %}
					{% if loop.index != 1 %}
						<hr>
					{% endif %}
					<div class="meal flex flex-between">
						<div class="left">
							<a href="{{ path('meal_show', {'id': meal.id}) }}">
								<h1 class="cds">{{ meal.nom }}</h1>
								<h2 class="gris">{{ meal.PostedBy.username }}, Végétarien</h2>
							</a>
						</div>
						<div class="right mtb-auto flex">
							<p class="mtb-auto note">
								<i btnfavorites="{{meal.id}}" class="{% for favorites in meal.mealFavorites %}{% if favorites.postedBy.id == app.user.id %}active{% endif %}{% endfor %} f-20 cursor-pointer fad fa-star"></i>
							</p>
						</div>
					</div>
				{% else %}
					<em>Aucun meal</em>
				{% endfor %}
			</div>
		</div>
	</section>
{% endblock %}
{% block javascript %}
	<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/leaflet.markercluster.js"></script>
	<script>
		addEventListener("load", () => {
new pagination("feedback", 3, 10, "block");
})
$("[btnFavorites]").click(function (e) {
e.preventDefault();
$.post("{{ path('meal_favorites') }}", {
meal_id: $(this).attr('btnFavorites'),
csrfData: "{{ csrf_token('meal-favorites') }}"
}, function (data) {
if (data.code == '200') {
$('[btnFavorites = "' + data.id + '"]').addClass('active')
}
if (data.code == '201') {
$('[btnFavorites = "' + data.id + '"]').removeClass('active')
}
}, 'json');
});
	</script>
{% endblock %}
